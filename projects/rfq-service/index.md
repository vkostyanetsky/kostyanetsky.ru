## 👀 Ситуация

У торговой компании заказчика есть регулярный процесс проценки. Перед тем как разместить заказ клиента, сотрудники компании связываются с несколькими поставщиками — получают от них цены, сроки и условия, а потом выбирают самый выгодный вариант.

## 💡 Задача

Проблема заключалась в том, что поставщики отвечали так, как удобно им: кто-то письмом, кто-то в WhatsApp, кто-то в Google Sheets. Дальше менеджер руками собирал это и заносил в ERP. Это отнимало время, порождало ошибки и споры в духе «а поставщик точно прислал именно это?».

Нужно было организовать более удобный способ сбора цен. Причём такой, чтобы поставщиков не пришлось учить в нём работать.

## 💪 Действия

Мы решили сделать для поставщиков веб-интерфейс, в котором они смогут делать проценку. Очевидный путь реализации — веб-клиент ERP — мы отмели сразу:

— придётся опубликовать ERP в «большой интернет»;
— понадобится создать в ERP учетные записи для всех поставщиков;
— необходимо купить пачку дополнительных лицензий для клиентских соединений.

Поэтому веб-приложение с интерфейсом проценки было решено делать независимым. Мы разделили решение на две части: доработку ERP и разработку самого веб-приложения.

**1. Сценарий в ERP**

Запуская проценку, менеджер создаёт в ERP документ-заявку, `Procurement Requisition`. В нём есть три набора данных:

- поставщики (кому отправляем);
- позиции номенклатуры (что оцениваем);
- дополнительные вопросы (условия, сроки, комментарии и т.п.).

После сохранения документа ERP генерирует персональную ссылку для каждого поставщика, которая работает как токен доступа. Она отправляется только конкретному поставщику, а значит, дополнительные проверки личности избыточны.

![Procurement Requisition](document.png)

Кроме этого, мы разработали для ERP HTTP-сервис, который умеет отдавать данные документа `Procurement Requisition` и принимать ответы поставщиков, сохраняя их как документ `Response to RFQ`.

**2. UX для поставщика**

Веб-приложение представляет собой простую форму, где можно ввести цены для каждой позиции документа `Procurement Requisition` и ответить на дополнительные вопросы от заказчика (сроки поставки, дополнительные условия и так далее).

В реальности поставщик редко заполняет всё за один подход, так что мы предусмотрели два действия:

- `Save as draft`: сохранение формы. Впоследствии форму можно снова открыть и отредактировать данные. Менеджеры заказчика эти данные не видят, так как на этом этапе проценка не считается завершённой.
- `Submit`: финальная отправка. После неё ответ поставщика становится виден менеджерам заказчика, а поставщик уже не может изменить данные, которые ввёл.

![UI](ui.png)

Фронт сделан на React, бэкенд — на Flask.

Бэкенд здесь выполняет роль прокси между веб-приложением и ERP. То есть веб-приложение получает уникальную ссылку, по которой перешёл поставщик, и отправляет её в прокси. Прокси по этой ссылке запрашивает из ERP товарные позиции для проценки и отдаёт их веб-приложению.

При такой схеме самому веб-приложению не нужно знать, где находится ERP и как там авторизоваться. Не требуется это и на следующем этапе, когда веб-приложение будет передавать в ERP результаты проценки.

![Схема](schema.png)

Конечно, можно было бы ходить из веб-приложения сразу на HTTP-сервис ERP, однако прокси снимает необходимость публиковать его в интернете. Кроме того, было бы сложнее обеспечить безопасную аутентификацию веб-приложения на HTTP-сервисе.

## 😎 Результат

В общем, в итоге проценка стала похожа на нормальный конвейер:

1. Менеджер заказчика формирует в ERP запрос на проценку;
2. Потом рассылает поставщикам персональные ссылки;
3. Поставщики отвечают в простом, удобном интерфейсе;
4. Их ответы сохраняются в ERP (и черновик, и финал).

Практический эффект: исчезло ручное сведение информации из разных каналов, снизилось количество ошибок при переносе данных в ERP, ускорилось получение предложений, а главное — всё было сделано без выдачи поставщикам доступа к ERP, без публикации каких-либо интерфейсов ERP в интернете, без расходов на дополнительные лицензии ERP и вообще без какого-либо менеджмента учёток для поставщиков.

Упрощённую версию проекта можно развернуть из [репозитория](https://github.com/vkostyanetsky/RFQ) на GitHub.

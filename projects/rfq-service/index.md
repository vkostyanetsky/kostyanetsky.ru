## 👀 Ситуация

У торговой компании заказчика есть регулярный процесс проценки. Перед тем, как разместить заказ клиента, сотрудники компании связываются с несколькими поставщиками — получают от них цены, сроки и условия, а потом выбирают самый выгодный вариант.

## 💡 Задача

Проблема заключалась в том, что поставщики отвечали так, как удобно им: кто-то письмом, кто-то в WhatsApp, кто-то в Google Sheets. Дальше менеджер руками собирал это и заносил в учётную систему. Это отнимало время, порождало ошибки и споры в духе «а поставщик точно прислал именно это?».

Чтобы решить проблему, мы решили сделать для поставщиков веб-интерфейс, в котором они смогут делать проценку. Предельно простой, чтобы их не пришлось учить в нём работать.

## 💪 Действия

Мы разделили решение на две части: доработку приложения 1С и разработку веб-приложения с интерфейсом проценки.

**1. Сценарий в 1С**

В 1С менеджер создаёт документ-заявку, `Procurement Requisition`, в котором есть три набора данных:

- поставщики (кому отправляем);
- позиции номенклатуры (что оцениваем);
- дополнительные вопросы (условия, сроки, комментарии и т.п.).

После сохранения документа 1С генерирует персональную ссылку для каждого поставщика, которая работает как токен доступа: она отправляется только конкретному поставщику, а значит, дополнительная проверка избыточна.

![Procurement Requisition](document.png)

Кроме этого, на стороне 1С мы разработали HTTP-сервис, который умеет отдавать данные документа `Procurement Requisition` и принимать ответы поставщиков, сохраняя их в виде документов `Response to RFQ`.

**2. UX для поставщика**

Чтобы избежать публикации веб-клиента внутренней ERP компании в интернет и создания в этой ERP учетных записей для поставщиков, мы написали отдельное веб-приложение. Де-факто это просто форма, где можно ввести цены для каждой позиции документа `Procurement Requisition` и ответить на дополнительные вопросы от заказчика (сроки поставки, дополнительные условия и так далее).

В реальности поставщик редко заполняет всё за один подход, так что мы сделали два действия:

- Save as draft: просто сохраняет форму. По ссылке потом можно снова перейти и отредактировать ввод. Менеджеры заказчика эти данные не видят, так как на этом этапе проценка не считается завершённой.
- Submit: финальная отправка. После неё ответ поставщика становится виден менеджерам заказчика, и поставщик уже не может изменить то, что ввёл.

![UI](ui.png)

Фронт сделан на React, бэкенд — на Flask.

Бэкенд здесь выполняет роль прокси между веб-приложением и 1С. То есть веб-приложение получает уникальную ссылку, по которой перешёл поставщик, и отправляет в прокси. Прокси по этой ссылке запрашивает из 1С товарные позиции для проценки и отдаёт их веб-приложению.

При такой схеме самому веб-приложению не нужно знать, где находится приложение 1С и как на нем авторизоваться. Не требуется это и на следующем этапе, когда веб-приложение будет передавать в приложение 1С результаты проценки.

![Схема](schema.png)

Конечно, можно было бы ходить из веб-приложения сразу на HTTP-сервис 1С, однако прокси снимает необходимость публиковать интерфейсы 1С наружу, в «большой интернет». Кроме того, было бы сложнее обеспечить безопасную аутентификацию веб-приложения на HTTP-сервисе.

## 😎 Результат

В общем, в итоге проценка стала похожа на нормальный конвейер:

1. Менеджер заказчика формирует запрос на проценку в приложении 1С;
2. Потом рассылает поставщикам персональные ссылки;
3. Поставщики отвечают в простом, удобном интерфейсе;
4. Их ответы сохраняются в документах `Response to RFQ` (и черновик, и финал).

Практический эффект: исчезло ручное сведение информации из разных каналов, снизилось количество ошибок при переносе данных в 1С, ускорилось получение предложений, а главное — всё было сделано без выдачи поставщикам доступа к внутреннему контуру 1С, без публикации частей этого контура в интернет, без расходов на дополнительные лицензии 1С и вообще без какого-либо менеджмента учёток для поставщиков.

Упрощенную версию проекта можно развернуть из [репозитория](https://github.com/vkostyanetsky/RFQ) на GitHub'е.
